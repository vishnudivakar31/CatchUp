(this["webpackJsonpcatchup-client"]=this["webpackJsonpcatchup-client"]||[]).push([[0],{71:function(e,t,n){},72:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=72},73:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var i=n(0),c=n.n(i),o=n(10),s=n.n(o),a=(n(71),n(22)),l=n(23),r=n(13),d=n(26),h=n(24),u=n(41),p=n(11),j=n(57),m=n.n(j),y=n(123),b=n(119),f=n(47),C=n.n(f),v=n(125),g=n.p+"static/media/ringtone_minimal.abc760ad.wav",O=n(124),U=(n(73),n(4)),x=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(a.a)(this,n),(i=t.call(this,e)).peer=i.props.peer,i.uuid=i.props.uuid,i.myConnection=i.props.myConnection,i.remoteConnection=i.props.remoteConnection,i.setRemoteConnection=i.props.setRemoteConnection,i.setMyConnection=i.props.setMyConnection,i.callButtonTapped=i.callButtonTapped.bind(Object(r.a)(i)),i.showCallingModal=i.showCallingModal.bind(Object(r.a)(i)),i.showCallRejectedAlert=i.showCallRejectedAlert.bind(Object(r.a)(i)),i.showConnectingModal=i.showConnectingModal.bind(Object(r.a)(i)),i.acceptCall=i.acceptCall.bind(Object(r.a)(i)),i.state={calling:!1,calling_from:"",call_rejected:!1,connecting:!1,callerID:""},i.ringtone=new Audio(g),i.ringtone.loop=!0,i}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.peer.on("open",(function(e){console.log("myID",e)})),this.peer.on("error",(function(e){return console.log(e)})),this.peer.on("connection",(function(t){t.on("open",(function(){e.props.setRemoteConnection(t),t.on("data",(function(t){t.message_type&&"calling"===t.message_type&&e.setState({calling:!0,calling_from:"".concat(t.userID," is calling you."),callerID:"".concat(t.userID)})}))}))}))}},{key:"componentDidUpdate",value:function(e,t){this.state.calling!==t.calling&&(this.state.calling?this.ringtone.play():(this.props.remoteConnection&&this.props.remoteConnection.send({message_type:"call-declined"}),this.ringtone.pause()))}},{key:"componentWillUnmount",value:function(){this.ringtone.remove()}},{key:"acceptCall",value:function(){this.props.setTargetUUID(this.state.callerID),this.props.setCalledByMe(!1),this.props.remoteConnection&&(this.props.remoteConnection.send({message_type:"call-accepted"}),this.props.history.push("/chat"),this.ringtone.pause())}},{key:"callButtonTapped",value:function(){var e=this;if(this.friendsUUID&&this.friendsUUID.value.length>0){var t=this.friendsUUID.value,n=this.peer.connect(t);this.props.setCalledByMe(!0),n.on("open",(function(){e.setMyConnection(n),e.props.setTargetUUID(t),n.send({message_type:"calling",userID:e.uuid}),n.on("data",(function(t){t.message_type&&"call-declined"===t.message_type?e.setState({call_rejected:!0,connecting:!1}):t.message_type&&"call-accepted"===t.message_type&&e.props.history.push("/chat")})),e.setState({connecting:!0})})),n.on("error",(function(e){console.log(e)}))}}},{key:"showCallingModal",value:function(){var e=this;return Object(U.jsx)(v.a,{open:this.state.calling,disableBackdropClick:!1,children:Object(U.jsxs)("div",{className:"calling_card",children:[Object(U.jsx)("p",{children:this.state.calling_from}),Object(U.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"10%"},children:[Object(U.jsx)(b.a,{color:"secondary",onClick:function(){return e.setState({calling:!1,calling_from:""})},children:"Reject"}),Object(U.jsx)(b.a,{color:"primary",variant:"contained",style:{marginLeft:"2%"},onClick:this.acceptCall,children:"Accept"})]})]})})}},{key:"showCallRejectedAlert",value:function(){var e=this;return Object(U.jsx)("div",{style:{display:this.state.call_rejected?"block":"none"},className:"alert-dialog",children:Object(U.jsx)(O.a,{severity:"warning",onClose:function(){return e.setState({call_rejected:!1})},children:"Call rejected. User is busy. Try again later."})})}},{key:"showConnectingModal",value:function(){return Object(U.jsx)("div",{style:{display:this.state.connecting?"block":"none"},className:"alert-dialog",children:Object(U.jsx)(O.a,{severity:"info",children:"Trying to connect with user. Please be patient."})})}},{key:"render",value:function(){var e=this;return Object(U.jsxs)("div",{className:"home",children:[Object(U.jsxs)("div",{className:"left-pane",children:[Object(U.jsx)("div",{className:"brand",children:"CatchUp"}),Object(U.jsx)("div",{className:"subtitle",children:"CatchUp is an anonymous video chat solution for you to communicate with each other without worrying about companies collecting your data and spying on you."})]}),Object(U.jsxs)("div",{className:"right-pane",children:[Object(U.jsx)("div",{className:"id-title",children:"Your ID:"}),Object(U.jsx)("div",{className:"your-id",children:this.uuid}),Object(U.jsxs)("div",{className:"input",children:[Object(U.jsx)(y.a,{id:"standard-basic",placeholder:"enter your friend's ID to connect",inputRef:function(t){return e.friendsUUID=t},fullWidth:!0}),Object(U.jsx)(b.a,{variant:"contained",color:"primary",className:"connect-button",startIcon:Object(U.jsx)(C.a,{}),onClick:this.callButtonTapped,children:"Call"})]})]}),this.showCallingModal(),this.showCallRejectedAlert(),this.showConnectingModal()]})}}]),n}(i.Component),D=Object(p.f)(x),M=(n(88),function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(a.a)(this,n),(i=t.call(this,e)).peer=i.props.peer,i.uuid=i.props.uuid,i.targetUUID=i.props.targetUUID,i.myVideoRef=c.a.createRef(),i.remoteVideoRef=c.a.createRef(),i.callFriend=i.callFriend.bind(Object(r.a)(i)),i.receiveCall=i.receiveCall.bind(Object(r.a)(i)),i.handleDisconnection=i.handleDisconnection.bind(Object(r.a)(i)),i.showDisconnectMessage=i.showDisconnectMessage.bind(Object(r.a)(i)),i.stopUserMedia=i.stopUserMedia.bind(Object(r.a)(i)),i.endCall=i.endCall.bind(Object(r.a)(i)),i.state={callDisconnected:!1},i}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.callFriend(),this.receiveCall(),this.remoteVideoRef.onended=function(t){return e.handleDisconnection()},this.peer.on("connection",(function(t){t.on("data",(function(t){t.message_type&&"call-disconnected"===t.message_type&&(e.myCallObj&&e.myCallObj.close(),e.receiveCallObj&&e.receiveCallObj.close(),e.props.history.push("/"))}))}))}},{key:"componentWillUnmount",value:function(){this.props.remoteConnection&&this.props.remoteConnection.send({message_type:"call-disconnected"}),this.props.myConnection&&this.props.myConnection.send({message_type:"call-disconnected"}),this.handleDisconnection()}},{key:"endCall",value:function(){var e=this.peer.connect(this.props.targetUUID);e.on("open",(function(){e.send({message_type:"call-disconnected"})})),this.myCallObj&&this.myCallObj.close(),this.receiveCallObj&&this.receiveCallObj.close(),this.props.history.push("/")}},{key:"showDisconnectMessage",value:function(){var e=this;return Object(U.jsx)(v.a,{open:this.state.callDisconnected,disableBackdropClick:!1,children:Object(U.jsxs)("div",{className:"calling_card",children:[Object(U.jsx)("p",{children:"Call disconnected."}),Object(U.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"10%"},children:Object(U.jsx)(b.a,{color:"primary",style:{marginLeft:"2%"},onClick:function(){return e.props.history.push("/")},children:"Ok"})})]})})}},{key:"handleDisconnection",value:function(){this.setState({callDisconnected:!0}),this.stopUserMedia(this.myVideoRef),null!==this.myVideoRef&&(this.myVideoRef.srcObject=null),this.stopUserMedia(this.remoteVideoRef),null!==this.remoteVideoRef&&(this.remoteVideoRef.srcObject=null)}},{key:"stopUserMedia",value:function(e){if(null!==e){var t=e.srcObject;if(t)t.getTracks().forEach((function(e){return e.stop()}))}}},{key:"callFriend",value:function(){var e=this;this.props.calledByMe&&navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(t){var n=e.peer.call(e.targetUUID,t);e.myCallObj=n,n.on("stream",(function(t){e.remoteVideoRef.srcObject=t})),n.on("close",(function(t){return e.endCall()})),e.myVideoRef.srcObject=t})).catch((function(e){return console.log(e)}))}},{key:"receiveCall",value:function(){var e=this;this.peer.on("call",(function(t){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(n){e.receiveCallObj=t,t.answer(n),t.on("stream",(function(t){null!==e.remoteVideoRef&&(e.remoteVideoRef.srcObject=t)})),t.on("close",(function(t){return e.endCall()})),e.myVideoRef.srcObject=n})).catch((function(e){return console.log(e)}))}))}},{key:"render",value:function(){var e=this;return Object(U.jsxs)("div",{className:"video-chat",children:[Object(U.jsxs)("div",{className:"header",children:[Object(U.jsx)("div",{className:"brand",children:"CatchUp"}),Object(U.jsxs)("div",{className:"connection-notification",children:[Object(U.jsx)(C.a,{fontSize:"small"}),Object(U.jsxs)("div",{style:{marginLeft:"2%",whiteSpace:"nowrap"},children:[this.targetUUID," connected."]})]})]}),Object(U.jsxs)("div",{className:"video-container",children:[Object(U.jsx)("div",{className:"remote-video-container",children:Object(U.jsx)("video",{className:"remote-video",ref:function(t){return e.remoteVideoRef=t},autoPlay:!0})}),Object(U.jsxs)("div",{className:"my-video-container",children:[Object(U.jsx)("video",{className:"my-video",ref:function(t){return e.myVideoRef=t},autoPlay:!0,muted:!0}),Object(U.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:Object(U.jsx)(b.a,{color:"secondary",variant:"contained",onClick:this.endCall,children:"End Call"})})]})]}),this.showDisconnectMessage()]})}}]),n}(i.Component)),k=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(U.jsx)("div",{style:{display:"flex",flex:1,height:"100%"},children:Object(U.jsx)(M,{calledByMe:this.props.calledByMe,peer:this.props.peer,uuid:this.props.uuid,myConnection:this.props.myConnection,remoteConnection:this.props.remoteConnection,targetUUID:this.props.targetUUID,history:this.props.history})})}}]),n}(i.Component),I=Object(p.f)(k),R=n(58),w=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(a.a)(this,n),(i=t.call(this,e)).uuid=Object(R.a)(9).replace(/[-_]/g,"A"),i.peer=new m.a(i.uuid),i.state={myConnection:void 0,remoteConnection:void 0,targetUUID:"",calledByMe:!1},i.setMyConnection=i.setMyConnection.bind(Object(r.a)(i)),i.setRemoteConnection=i.setRemoteConnection.bind(Object(r.a)(i)),i.setTargetUUID=i.setTargetUUID.bind(Object(r.a)(i)),i.setCalledByMe=i.setCalledByMe.bind(Object(r.a)(i)),i}return Object(l.a)(n,[{key:"setMyConnection",value:function(e){this.setState({myConnection:e})}},{key:"setRemoteConnection",value:function(e){this.setState({remoteConnection:e})}},{key:"setTargetUUID",value:function(e){this.setState({targetUUID:e})}},{key:"setCalledByMe",value:function(e){this.setState({calledByMe:e})}},{key:"render",value:function(){return Object(U.jsx)(u.a,{children:Object(U.jsxs)(p.c,{children:[Object(U.jsx)(p.a,{path:"/chat",children:Object(U.jsx)(I,{peer:this.peer,uuid:this.uuid,myConnection:this.state.myConnection,remoteConnection:this.state.remoteConnection,targetUUID:this.state.targetUUID,calledByMe:this.state.calledByMe})}),Object(U.jsx)(p.a,{path:"/",children:Object(U.jsx)(D,{peer:this.peer,uuid:this.uuid,myConnection:this.state.myConnection,remoteConnection:this.state.remoteConnection,setMyConnection:this.setMyConnection,setRemoteConnection:this.setRemoteConnection,setTargetUUID:this.setTargetUUID,setCalledByMe:this.setCalledByMe})})]})})}}]),n}(i.Component),_=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,127)).then((function(t){var n=t.getCLS,i=t.getFID,c=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),i(e),c(e),o(e),s(e)}))};s.a.render(Object(U.jsx)(c.a.StrictMode,{children:Object(U.jsx)(w,{})}),document.getElementById("root")),_()}},[[89,1,2]]]);
//# sourceMappingURL=main.94e3fd9e.chunk.js.map