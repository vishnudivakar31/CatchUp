(this["webpackJsonpcatchup-client"]=this["webpackJsonpcatchup-client"]||[]).push([[0],{82:function(e,t,n){},83:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=83},84:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){"use strict";n.r(t);var s=n(0),i=n.n(s),o=n(11),a=n.n(o),c=(n(82),n(20)),r=n(21),l=n(9),d=n(24),h=n(23),u=n(44),p=n(12),m=n(61),j=n.n(m),f=n(130),g=n(125),y=n(50),b=n.n(y),O=n(131),v=n.p+"static/media/ringtone_minimal.abc760ad.wav",C=n(132),x=(n(84),n(2)),M=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(c.a)(this,n),(s=t.call(this,e)).peer=s.props.peer,s.uuid=s.props.uuid,s.myConnection=s.props.myConnection,s.remoteConnection=s.props.remoteConnection,s.setRemoteConnection=s.props.setRemoteConnection,s.setMyConnection=s.props.setMyConnection,s.callButtonTapped=s.callButtonTapped.bind(Object(l.a)(s)),s.showCallingModal=s.showCallingModal.bind(Object(l.a)(s)),s.showCallRejectedAlert=s.showCallRejectedAlert.bind(Object(l.a)(s)),s.showConnectingModal=s.showConnectingModal.bind(Object(l.a)(s)),s.acceptCall=s.acceptCall.bind(Object(l.a)(s)),s.state={calling:!1,calling_from:"",call_rejected:!1,connecting:!1,callerID:""},s.ringtone=new Audio(v),s.ringtone.loop=!0,s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.peer.on("open",(function(e){console.log("myID",e)})),this.peer.on("error",(function(e){return console.log(e)})),this.peer.on("connection",(function(t){t.on("open",(function(){e.props.setRemoteConnection(t),t.on("data",(function(t){t.message_type&&"calling"===t.message_type&&e.setState({calling:!0,calling_from:"".concat(t.userID," is calling you."),callerID:"".concat(t.userID)})}))}))}))}},{key:"componentDidUpdate",value:function(e,t){this.state.calling!==t.calling&&(this.state.calling?this.ringtone.play():(this.props.remoteConnection&&this.props.remoteConnection.send({message_type:"call-declined"}),this.ringtone.pause()))}},{key:"componentWillUnmount",value:function(){this.ringtone.remove()}},{key:"acceptCall",value:function(){this.props.setTargetUUID(this.state.callerID),this.props.setCalledByMe(!1),this.props.remoteConnection&&(this.props.remoteConnection.send({message_type:"call-accepted"}),this.props.history.push("/chat"),this.ringtone.pause())}},{key:"callButtonTapped",value:function(){var e=this;if(this.friendsUUID&&this.friendsUUID.value.length>0){var t=this.friendsUUID.value,n=this.peer.connect(t);this.props.setCalledByMe(!0),n.on("open",(function(){e.setMyConnection(n),e.props.setTargetUUID(t),n.send({message_type:"calling",userID:e.uuid}),n.on("data",(function(t){t.message_type&&"call-declined"===t.message_type?e.setState({call_rejected:!0,connecting:!1}):t.message_type&&"call-accepted"===t.message_type&&e.props.history.push("/chat")})),e.setState({connecting:!0})})),n.on("error",(function(e){console.log(e)}))}}},{key:"showCallingModal",value:function(){var e=this;return Object(x.jsx)(O.a,{open:this.state.calling,disableBackdropClick:!1,children:Object(x.jsxs)("div",{className:"calling_card",children:[Object(x.jsx)("p",{children:this.state.calling_from}),Object(x.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"10%"},children:[Object(x.jsx)(g.a,{color:"secondary",onClick:function(){return e.setState({calling:!1,calling_from:""})},children:"Reject"}),Object(x.jsx)(g.a,{color:"primary",variant:"contained",style:{marginLeft:"2%"},onClick:this.acceptCall,children:"Accept"})]})]})})}},{key:"showCallRejectedAlert",value:function(){var e=this;return Object(x.jsx)("div",{style:{display:this.state.call_rejected?"block":"none"},className:"alert-dialog",children:Object(x.jsx)(C.a,{severity:"warning",onClose:function(){return e.setState({call_rejected:!1})},children:"Call rejected. User is busy. Try again later."})})}},{key:"showConnectingModal",value:function(){return Object(x.jsx)("div",{style:{display:this.state.connecting?"block":"none"},className:"alert-dialog",children:Object(x.jsx)(C.a,{severity:"info",children:"Trying to connect with user. Please be patient."})})}},{key:"render",value:function(){var e=this;return Object(x.jsxs)("div",{className:"home",children:[Object(x.jsxs)("div",{className:"left-pane",children:[Object(x.jsx)("div",{className:"brand",children:"CatchUp"}),Object(x.jsx)("div",{className:"subtitle",children:"CatchUp is an anonymous video chat solution for you to communicate with each other without worrying about companies collecting your data and spying on you."})]}),Object(x.jsxs)("div",{className:"right-pane",children:[Object(x.jsx)("div",{className:"id-title",children:"Your ID:"}),Object(x.jsx)("div",{className:"your-id",children:this.uuid}),Object(x.jsxs)("div",{className:"input",children:[Object(x.jsx)(f.a,{id:"standard-basic",placeholder:"enter your friend's ID to connect",inputRef:function(t){return e.friendsUUID=t},fullWidth:!0}),Object(x.jsx)(g.a,{variant:"contained",color:"primary",className:"connect-button",startIcon:Object(x.jsx)(b.a,{}),onClick:this.callButtonTapped,children:"Call"})]})]}),this.showCallingModal(),this.showCallRejectedAlert(),this.showConnectingModal()]})}}]),n}(s.Component),U=Object(p.f)(M),k=(n(96),function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(c.a)(this,n),(s=t.call(this,e)).formatAMPM=s.formatAMPM.bind(Object(l.a)(s)),s.messageRef=i.a.createRef(),s.state={messages:[]},s.sendMessage=s.sendMessage.bind(Object(l.a)(s)),s.addMessage=s.addMessage.bind(Object(l.a)(s)),s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.calledByMe?this.props.myConnection&&this.props.myConnection.on("data",(function(t){e.addMessage(t)})):this.props.remoteConnection&&this.props.remoteConnection.on("data",(function(t){e.addMessage(t)})),this.messageRef.scrollTop=this.messageRef.scrollHeight}},{key:"componentDidUpdate",value:function(e,t){t!==this.state.messages&&this.messageRef&&(this.messageRef.scrollTop=this.messageRef.scrollHeight)}},{key:"addMessage",value:function(e){if("text-message"===e.message_type){var t=this.state.messages;t.push(e),this.setState({messages:t})}}},{key:"formatAMPM",value:function(e){var t=e.getHours(),n=e.getMinutes(),s=t>=12?"pm":"am";return(t=(t%=12)||12)+":"+(n=n<10?"0"+n:n)+":"+e.getSeconds()+" "+s}},{key:"sendMessage",value:function(){var e=this.messageTextField?this.messageTextField.value:"";if(e.length>0){var t={message_type:"text-message",send:this.props.uuid,target:this.props.targetUUID,msg:e,time:this.formatAMPM(new Date)};this.props.calledByMe&&this.props.myConnection?(this.props.myConnection.send(t),this.addMessage(t),this.messageTextField.value=""):!this.props.calledByMe&&this.props.remoteConnection&&(this.props.remoteConnection.send(t),this.addMessage(t),this.messageTextField.value="")}}},{key:"render",value:function(){var e=this;return Object(x.jsxs)("div",{className:"text-chat",children:[Object(x.jsx)("div",{className:"chat-header",children:"Chats"}),Object(x.jsx)("div",{className:"chat-message-display",ref:function(t){return e.messageRef=t},children:Object(x.jsx)("div",{className:"table-cell",children:this.state.messages.map((function(t,n){return Object(x.jsxs)("div",{className:"message-container ".concat(t.send===e.props.uuid?"right":"left"),children:[Object(x.jsx)("div",{className:"message-bubble ".concat(t.send===e.props.uuid?"right":"left"),children:t.msg}),Object(x.jsx)("div",{className:"message-time",children:t.time})]},n)}))})}),Object(x.jsxs)("div",{className:"input-group",children:[Object(x.jsx)(f.a,{placeholder:"type message...",inputRef:function(t){return e.messageTextField=t},fullWidth:!0,onKeyPress:function(t){"Enter"===t.key&&e.sendMessage()}}),Object(x.jsx)(g.a,{color:"primary",variant:"contained",style:{marginLeft:"2%"},onClick:this.sendMessage,children:"Send"})]})]})}}]),n}(s.Component)),D=n(129),R=n(66),w=n.n(R),I=n(64),N=n.n(I),_=n(62),T=n.n(_),B=n(63),S=n.n(B),V=n(65),A=n.n(V),F=(n(97),function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(c.a)(this,n),(s=t.call(this,e)).peer=s.props.peer,s.uuid=s.props.uuid,s.targetUUID=s.props.targetUUID,s.myVideoRef=i.a.createRef(),s.remoteVideoRef=i.a.createRef(),s.callFriend=s.callFriend.bind(Object(l.a)(s)),s.receiveCall=s.receiveCall.bind(Object(l.a)(s)),s.handleDisconnection=s.handleDisconnection.bind(Object(l.a)(s)),s.showDisconnectMessage=s.showDisconnectMessage.bind(Object(l.a)(s)),s.stopUserMedia=s.stopUserMedia.bind(Object(l.a)(s)),s.endCall=s.endCall.bind(Object(l.a)(s)),s.toggleAudio=s.toggleAudio.bind(Object(l.a)(s)),s.toggleVideo=s.toggleVideo.bind(Object(l.a)(s)),s.state={callDisconnected:!1,videoOff:!1,audioOff:!1},s}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.callFriend(),this.receiveCall(),this.remoteVideoRef.onended=function(t){return e.handleDisconnection()},this.peer.on("connection",(function(t){t.on("data",(function(t){t.message_type&&"call-disconnected"===t.message_type&&(e.myCallObj&&e.myCallObj.close(),e.receiveCallObj&&e.receiveCallObj.close(),e.props.history.push("/"))}))}))}},{key:"componentDidUpdate",value:function(e,t){this.state.audioOff!==t.audioOff&&this.toggleAudio(),this.state.videoOff!==t.videoOff&&this.toggleVideo()}},{key:"toggleAudio",value:function(){this.myStream&&(this.myStream.getAudioTracks()[0].enabled=!this.state.audioOff)}},{key:"toggleVideo",value:function(){this.myStream&&(this.myStream.getVideoTracks()[0].enabled=!this.state.videoOff)}},{key:"componentWillUnmount",value:function(){this.props.remoteConnection&&this.props.remoteConnection.send({message_type:"call-disconnected"}),this.props.myConnection&&this.props.myConnection.send({message_type:"call-disconnected"}),this.handleDisconnection()}},{key:"endCall",value:function(){var e=this.peer.connect(this.props.targetUUID);e.on("open",(function(){e.send({message_type:"call-disconnected"})})),this.myCallObj&&this.myCallObj.close(),this.receiveCallObj&&this.receiveCallObj.close(),this.props.history.push("/")}},{key:"showDisconnectMessage",value:function(){var e=this;return Object(x.jsx)(O.a,{open:this.state.callDisconnected,disableBackdropClick:!1,children:Object(x.jsxs)("div",{className:"calling_card",children:[Object(x.jsx)("p",{children:"Call disconnected."}),Object(x.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"10%"},children:Object(x.jsx)(g.a,{color:"primary",style:{marginLeft:"2%"},onClick:function(){return e.props.history.push("/")},children:"Ok"})})]})})}},{key:"handleDisconnection",value:function(){this.setState({callDisconnected:!0}),this.stopUserMedia(this.myVideoRef),null!==this.myVideoRef&&(this.myVideoRef.srcObject=null),this.stopUserMedia(this.remoteVideoRef),null!==this.remoteVideoRef&&(this.remoteVideoRef.srcObject=null)}},{key:"stopUserMedia",value:function(e){if(null!==e){var t=e.srcObject;if(t)t.getTracks().forEach((function(e){return e.stop()}))}}},{key:"callFriend",value:function(){var e=this;this.props.calledByMe&&navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(t){e.myStream=t;var n=e.peer.call(e.targetUUID,t);e.myCallObj=n,n.on("stream",(function(t){e.remoteVideoRef.srcObject=t})),n.on("close",(function(t){return e.endCall()})),e.myVideoRef.srcObject=t})).catch((function(e){return console.log(e)}))}},{key:"receiveCall",value:function(){var e=this;this.peer.on("call",(function(t){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(n){e.myStream=n,e.receiveCallObj=t,t.answer(n),t.on("stream",(function(t){null!==e.remoteVideoRef&&(e.remoteVideoRef.srcObject=t)})),t.on("close",(function(t){return e.endCall()})),e.myVideoRef.srcObject=n})).catch((function(e){return console.log(e)}))}))}},{key:"render",value:function(){var e=this;return Object(x.jsxs)("div",{className:"video-chat",children:[Object(x.jsxs)("div",{className:"header",children:[Object(x.jsx)("div",{className:"brand",children:"CatchUp"}),Object(x.jsxs)("div",{className:"connection-notification",children:[Object(x.jsx)(b.a,{fontSize:"small"}),Object(x.jsxs)("div",{style:{marginLeft:"2%",whiteSpace:"nowrap"},children:[this.targetUUID," connected."]})]})]}),Object(x.jsxs)("div",{className:"video-container",children:[Object(x.jsx)("div",{className:"remote-video-container",children:Object(x.jsx)("video",{className:"remote-video",ref:function(t){return e.remoteVideoRef=t},autoPlay:!0})}),Object(x.jsxs)("div",{className:"my-video-container",children:[Object(x.jsx)("video",{className:"my-video",ref:function(t){return e.myVideoRef=t},autoPlay:!0,muted:!0}),Object(x.jsxs)("div",{style:{display:"flex",justifyContent:"center",marginTop:"2%"},children:[Object(x.jsx)(D.a,{style:{padding:"2%",border:"0.5px solid grey",borderRadius:"20px",background:this.state.videoOff?"grey":"white",color:this.state.videoOff?"white":"grey"},onClick:function(){return e.setState({videoOff:!e.state.videoOff})},children:this.state.videoOff?Object(x.jsx)(T.a,{}):Object(x.jsx)(S.a,{})}),Object(x.jsx)(D.a,{style:{padding:"2%",border:"0.5px solid grey",borderRadius:"20px",marginLeft:"3%",background:this.state.audioOff?"grey":"white",color:this.state.audioOff?"white":"grey"},onClick:function(){return e.setState({audioOff:!e.state.audioOff})},children:this.state.audioOff?Object(x.jsx)(N.a,{}):Object(x.jsx)(A.a,{})}),Object(x.jsx)(D.a,{onClick:this.endCall,style:{padding:"2%",borderRadius:"20px",border:"0.5px solid grey",background:"red",color:"white",marginLeft:"3%"},children:Object(x.jsx)(w.a,{})})]}),Object(x.jsx)(k,{peer:this.props.peer,uuid:this.props.uuid,targetUUID:this.props.targetUUID,calledByMe:this.props.calledByMe,myConnection:this.props.myConnection,remoteConnection:this.props.remoteConnection})]})]}),this.showDisconnectMessage()]})}}]),n}(s.Component)),P=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){return Object(x.jsx)("div",{style:{display:"flex",flex:1,height:"100%"},children:Object(x.jsx)(F,{calledByMe:this.props.calledByMe,peer:this.props.peer,uuid:this.props.uuid,myConnection:this.props.myConnection,remoteConnection:this.props.remoteConnection,targetUUID:this.props.targetUUID,history:this.props.history})})}}]),n}(s.Component),L=Object(p.f)(P),E=n(67),W=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(c.a)(this,n),(s=t.call(this,e)).uuid=Object(E.a)(9).replace(/[-_]/g,"A"),s.peer=new j.a(s.uuid),s.state={myConnection:void 0,remoteConnection:void 0,targetUUID:"",calledByMe:!1},s.setMyConnection=s.setMyConnection.bind(Object(l.a)(s)),s.setRemoteConnection=s.setRemoteConnection.bind(Object(l.a)(s)),s.setTargetUUID=s.setTargetUUID.bind(Object(l.a)(s)),s.setCalledByMe=s.setCalledByMe.bind(Object(l.a)(s)),s}return Object(r.a)(n,[{key:"setMyConnection",value:function(e){this.setState({myConnection:e})}},{key:"setRemoteConnection",value:function(e){this.setState({remoteConnection:e})}},{key:"setTargetUUID",value:function(e){this.setState({targetUUID:e})}},{key:"setCalledByMe",value:function(e){this.setState({calledByMe:e})}},{key:"render",value:function(){return Object(x.jsx)(u.a,{children:Object(x.jsxs)(p.c,{children:[Object(x.jsx)(p.a,{path:"/chat",children:Object(x.jsx)(L,{peer:this.peer,uuid:this.uuid,myConnection:this.state.myConnection,remoteConnection:this.state.remoteConnection,targetUUID:this.state.targetUUID,calledByMe:this.state.calledByMe})}),Object(x.jsx)(p.a,{path:"/",children:Object(x.jsx)(U,{peer:this.peer,uuid:this.uuid,myConnection:this.state.myConnection,remoteConnection:this.state.remoteConnection,setMyConnection:this.setMyConnection,setRemoteConnection:this.setRemoteConnection,setTargetUUID:this.setTargetUUID,setCalledByMe:this.setCalledByMe})})]})})}}]),n}(s.Component),H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,134)).then((function(t){var n=t.getCLS,s=t.getFID,i=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),s(e),i(e),o(e),a(e)}))};a.a.render(Object(x.jsx)(i.a.StrictMode,{children:Object(x.jsx)(W,{})}),document.getElementById("root")),H()}},[[98,1,2]]]);
//# sourceMappingURL=main.0e0eb017.chunk.js.map